# Chains in `iptables`

Chains are sequences of rules in `iptables` that dictate how packets are processed. Each chain belongs to a specific table and is associated with particular points in the packet processing workflow.

---

### **Built-in Chains**

The chains available depend on the table in use. Below is a detailed explanation of each built-in chain and its role:

#### **1. `INPUT`**

- **Purpose**: Handles packets destined for the local system.
- **Tables**: `filter`, `mangle`, `security`
- **Example Use Case**: Allow incoming SSH connections.
    
    ```bash
    iptables -A INPUT -p tcp --dport 22 -j ACCEPT
    ```
    

#### **2. `OUTPUT`**

- **Purpose**: Handles packets generated by the local system.
- **Tables**: `filter`, `nat`, `mangle`, `security`, `raw`
- **Example Use Case**: Route outgoing HTTP traffic through a specific port.
    
    ```bash
    iptables -A OUTPUT -p tcp --dport 80 -j ACCEPT
    ```
    

#### **3. `FORWARD`**

- **Purpose**: Handles packets that are routed through the system.
- **Tables**: `filter`, `mangle`, `security`
- **Example Use Case**: Allow packet forwarding for a private network.
    
    ```bash
    iptables -A FORWARD -s 192.168.1.0/24 -j ACCEPT
    ```
    

#### **4. `PREROUTING`**

- **Purpose**: Alters packets as soon as they arrive, before routing decisions are made.
- **Tables**: `nat`, `mangle`, `raw`, `security`
- **Example Use Case**: Redirect incoming HTTP traffic to a different port.
    
    ```bash
    iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIRECT --to-port 8080
    ```
    

#### **5. `POSTROUTING`**

- **Purpose**: Alters packets after routing decisions, typically for NAT or QoS purposes.
- **Tables**: `nat`, `mangle`, `security`
- **Example Use Case**: Apply source NAT to outgoing traffic.
    
    ```bash
    iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
    ```
    

---

### **User-Defined Chains**

- **Purpose**: Custom chains created by administrators for modular rule management.
- **Commands**:
    - Create a chain:
        
        ```bash
        iptables -N MY_CHAIN
        ```
        
    - Add rules to a user-defined chain:
        
        ```bash
        iptables -A MY_CHAIN -p tcp --dport 443 -j ACCEPT
        ```
        
    - Direct traffic to a user-defined chain:
        
        ```bash
        iptables -A INPUT -j MY_CHAIN
        ```
        
    - Delete a chain:
        
        ```bash
        iptables -X MY_CHAIN
        ```
        

---

### **Chain Interaction**

Packets traverse chains depending on their flow:

1. Incoming packets hit `PREROUTING`, then proceed to `INPUT` if destined for the host.
2. Outgoing packets hit `OUTPUT` and `POSTROUTING`.
3. Routed packets pass through `FORWARD`, then `POSTROUTING`.

---

### **Examples of Chain Usage**

1. **Block all traffic except SSH**:
    
    ```bash
    iptables -P INPUT DROP
    iptables -A INPUT -p tcp --dport 22 -j ACCEPT
    ```
    
2. **Redirect HTTP traffic**:
    
    ```bash
    iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIRECT --to-port 8080
    ```
    
3. **Forward packets between networks**:
    
    ```bash
    iptables -A FORWARD -i eth0 -o eth1 -j ACCEPT
    ```
    

By understanding and effectively configuring chains, administrators can finely control traffic flow and system behavior.