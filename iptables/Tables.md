# `iptables` Tables

In `iptables`, **tables** categorize rules based on specific packet processing requirements. Each table has its unique **chains** (rule groups), **options** (actions), **matches** (criteria), and **targets** (results).

---

### **1. `filter` Table (Default)**

#### **Purpose**:

Handles packet filtering (allowing, dropping, or rejecting packets).

#### **Available Chains**:

- **`INPUT`**: Handles packets destined for the host.
- **`FORWARD`**: Processes packets routed through the host.
- **`OUTPUT`**: Manages packets generated by the host.

#### **Common Options**:

- **`-A`**: Append a rule.
- **`-D`**: Delete a rule.
- **`-I`**: Insert a rule.
- **`-P`**: Set the default policy.

#### **Common Matches**:

- **`-p`**: Protocol (e.g., `tcp`, `udp`, `icmp`).
- **`-s`**: Source IP.
- **`-d`**: Destination IP.
- **`--dport`**: Destination port.
- **`--sport`**: Source port.
- **`-m state`**: Connection state (`NEW`, `ESTABLISHED`, `RELATED`).

#### **Targets**:

- **`ACCEPT`**: Allow the packet.
- **`DROP`**: Silently drop the packet.
- **`REJECT`**: Drop the packet with an error response.
- **`LOG`**: Log the packet.

#### **Examples**:

1. Allow SSH:
    
    ```bash
    iptables -A INPUT -p tcp --dport 22 -j ACCEPT
    ```
    
2. Drop all incoming traffic except SSH:
    
    ```bash
    iptables -P INPUT DROP
    iptables -A INPUT -p tcp --dport 22 -j ACCEPT
    ```
    

---

### **2. `nat` Table**

#### **Purpose**:

Handles Network Address Translation (e.g., port forwarding, IP masquerading).

#### **Available Chains**:

- **`PREROUTING`**: Modify packets before routing.
- **`OUTPUT`**: Modify locally generated packets.
- **`POSTROUTING`**: Modify packets after routing.

#### **Common Options**:

- Same as `filter` table.

#### **Common Matches**:

- Same as `filter` table.
- **`--to-port`**: Specify the new port.
- **`--to-destination`**: Specify the new destination.

#### **Targets**:

- **`DNAT`**: Change the destination IP/port.
- **`SNAT`**: Change the source IP/port.
- **`MASQUERADE`**: Hide source IP with the outgoing interface IP.
- **`REDIRECT`**: Redirect traffic to a local port.

#### **Examples**:

1. Redirect HTTP traffic to port 8080:
    
    ```bash
    iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIRECT --to-port 8080
    ```
    
2. Enable IP masquerading:
    
    ```bash
    iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
    ```
    

---

### **3. `mangle` Table**

#### **Purpose**:

Alters packet headers, such as TOS (Type of Service) and TTL (Time to Live).

#### **Available Chains**:

- **`PREROUTING`**
- **`INPUT`**
- **`FORWARD`**
- **`OUTPUT`**
- **`POSTROUTING`**

#### **Common Options**:

- Same as `filter` table.

#### **Common Matches**:

- Same as `filter` table.
- **`-m ttl`**: Match TTL value.
- **`--tos`**: Match TOS value.

#### **Targets**:

- **`TTL`**: Modify the TTL value.
- **`TOS`**: Modify the TOS value.
- **`MARK`**: Mark the packet for routing or QoS purposes.

#### **Examples**:

1. Set TTL for outgoing packets:
    
    ```bash
    iptables -t mangle -A OUTPUT -p tcp --dport 80 -j TTL --ttl-set 64
    ```
    
2. Mark packets for routing:
    
    ```bash
    iptables -t mangle -A PREROUTING -p tcp --dport 22 -j MARK --set-mark 1
    ```
    

---

### **4. `raw` Table**

#### **Purpose**:

Bypasses connection tracking to improve performance.

#### **Available Chains**:

- **`PREROUTING`**
- **`OUTPUT`**

#### **Common Options**:

- Same as `filter` table.

#### **Common Matches**:

- Same as `filter` table.

#### **Targets**:

- **`NOTRACK`**: Disable connection tracking for matching packets.

#### **Examples**:

1. Disable connection tracking for HTTP packets:
    
    ```bash
    iptables -t raw -A PREROUTING -p tcp --dport 80 -j NOTRACK
    ```
    

---

### **5. `security` Table**

#### **Purpose**:

Implements access control for Mandatory Access Control (MAC) systems like SELinux.

#### **Available Chains**:

- **`PREROUTING`**
- **`INPUT`**
- **`FORWARD`**
- **`OUTPUT`**
- **`POSTROUTING`**

#### **Common Options**:

- Same as `filter` table.

#### **Common Matches**:

- Same as `filter` table.

#### **Targets**:

- **`ACCEPT`**: Allow the packet.
- **`DROP`**: Drop the packet.
- **`SECMARK`**: Apply a security mark.

#### **Examples**:

1. Allow SSH while enforcing SELinux:
    
    ```bash
    iptables -t security -A INPUT -p tcp --dport 22 -j ACCEPT
    ```
    

---

### **Summary Table of Chains, Matches, and Targets**

|**Table**|**Chains**|**Common Matches**|**Targets**|
|---|---|---|---|
|`filter`|`INPUT`, `FORWARD`, `OUTPUT`|Protocol, IP, Ports|`ACCEPT`, `DROP`, `REJECT`|
|`nat`|`PREROUTING`, `OUTPUT`, `POSTROUTING`|Protocol, Ports, NAT|`DNAT`, `SNAT`, `MASQUERADE`|
|`mangle`|All five chains|TOS, TTL, Marks|`TTL`, `TOS`, `MARK`|
|`raw`|`PREROUTING`, `OUTPUT`|Protocol, Ports|`NOTRACK`|
|`security`|All five chains|Protocol, IP|`ACCEPT`, `DROP`, `SECMARK`|

